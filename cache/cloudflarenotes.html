<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8" /><title>Cloudflare Workers 现已支持更多 NPM 包：结合 polyfill 和原生代码以支持 Node.js API</title></head><body><h1 class="text-2xl font-semibold mb-2">Cloudflare Workers 现已支持更多 NPM 包：结合 polyfill 和原生代码以支持 Node.js API</h1><html><head></head><body><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100022862" data-ratio="0.5611111111111111" data-s="300,640" data-type="webp" data-w="1080" style="font-size: var(--articleFontsize);letter-spacing: 0.034em;text-align: center;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_jpg%2Fqcj0oPqOL8Wib0UDSXj1sXQHIzcCdHDSJuy5Wdr2RblUEqZJNodIpjMTY9IMgMlfrwuopLqNUbvUic7iaQRahStqw%2F640%3Fwx_fmt%3Dwebp%26from%3Dappmsg"><span style="font-size: var(--articleFontsize);letter-spacing: 0.034em;"></span><br></section><section style="margin-left: 16px;margin-right: 16px;"><span style="font-size: 14px;">我们很高兴地宣布为 Workers 和 Pages 推出</span><a target="_blank" href="https://developers.cloudflare.com/workers/runtime-apis/nodejs/" textvalue="改进的 Node.js 兼容性" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="font-size: 14px;"><span style="font-size: 14px;">改进的 Node.js 兼容性</span></a><span style="font-size: 14px;">预览。更广泛的兼容性让您可以使用更多 NPM 包，并在编写 Workers 时充分利用 JavaScript 生态系统的优势。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">我们最新版本的 Node.js 兼容性结合了我们先前努力实现的最佳特征。<a target="_blank" href="https://workers.cloudflare.com/" textvalue="Cloudflare Workers" linktype="text" imgurl="" tab="outerlink" data-linktype="2">Cloudflare Workers</a> 以某种形式支持 Node.js 已有相当长一段时间了。我们于 <a target="_blank" href="https://blog.cloudflare.com/node-js-support-cloudflare-workers" textvalue="2021 年" linktype="text" imgurl="" tab="outerlink" data-linktype="2">2021 年</a> 首次宣布对 polyfill 的支持 ，后来随着时间的推移不断 <a target="_blank" href="https://blog.cloudflare.com/workers-node-js-asynclocalstorage" textvalue="扩展对部分 Node.js API 的内置支持" linktype="text" imgurl="" tab="outerlink" data-linktype="2">扩展对部分 Node.js API 的内置支持</a> 。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">最新的改进将带来更多便捷：</span></section><ul class="list-paddingleft-1" style="list-style-type: square;"><li><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">您可在 Workers 上使用更多 </span><a target="_blank" href="https://en.wikipedia.org/wiki/Npm" textvalue="NPM" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">NPM</a><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;"> 包。</span></section></li><li><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">您可以使用不是用 node : prefix 导入 Node.js API 的包</span></section></li><li><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">您可以在 </span><a target="_blank" href="https://workers-nodejs-compat-matrix.pages.dev/" textvalue="Workers 上使用更多 Node.js API" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">Workers 上使用更多 Node.js API</a><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;"> ，包括 </span><a target="_blank" href="https://nodejs.org/docs/latest/api/async_hooks.html" textvalue="async_hooks" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">async_hooks</a><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;"> 、 </span><a target="_blank" href="https://nodejs.org/api/buffer.html" textvalue="Buffer " linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">Buffer </a><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">、 </span><a target="_blank" href="https://nodejs.org/api/dns.html" textvalue="dns" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">dns</a><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;"> 、 </span><a target="_blank" href="https://nodejs.org/docs/latest/api/os.html" textvalue="os" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">os</a><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;"> 和 </span><a target="_blank" href="https://nodejs.org/docs/latest/api/events.html" textvalue="events" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">events</a><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;"> 上的大多数方法。许多其他方法（例如 </span><a target="_blank" href="https://nodejs.org/api/fs.html" textvalue="fs" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">fs</a><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;"> 或 </span><a target="_blank" href="https://nodejs.org/docs/latest/api/process.html" textvalue="process" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">process</a><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;"> ）都可以使用模拟方法来导入。</span></section></li></ul><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">如要尝试，请将以下标志添加到 wrangler.toml ，并使用 <a target="_blank" href="https://developers.cloudflare.com/workers/wrangler/" textvalue="Wrangler 部署您的 " linktype="text" imgurl="" tab="outerlink" data-linktype="2">Wrangler 部署您的 </a>Worker ：</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">compatibility_flags = ["nodejs_compat_v2"]</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">无法使用 nodejs_compat 导入的包（即使是作为另一个包的依赖）现已可以加载。其中包括流行的包，例如 <a target="_blank" href="https://www.npmjs.com/package/body-parser" textvalue="body-parser" linktype="text" imgurl="" tab="outerlink" data-linktype="2">body-parser</a> 、<a target="_blank" href="https://www.npmjs.com/package/jsonwebtoken" textvalue=" jsonwebtoken" linktype="text" imgurl="" tab="outerlink" data-linktype="2"> jsonwebtoken</a> 、 {} <a target="_blank" href="https://www.npmjs.com/package/got" textvalue="Got" linktype="text" imgurl="" tab="outerlink" data-linktype="2">Got</a> 、<a target="_blank" href="https://www.npmjs.com/package/passport" textvalue="passport" linktype="text" imgurl="" tab="outerlink" data-linktype="2">passport</a>、 <a target="_blank" href="https://www.npmjs.com/package/md5" textvalue="md5" linktype="text" imgurl="" tab="outerlink" data-linktype="2">md5</a> 、 <a target="_blank" href="https://www.npmjs.com/package/knex" textvalue="knex" linktype="text" imgurl="" tab="outerlink" data-linktype="2">knex</a> 、 <a target="_blank" href="https://www.npmjs.com/package/mailparser" textvalue="mailparser" linktype="text" imgurl="" tab="outerlink" data-linktype="2">mailparser</a> 、 <a target="_blank" href="https://www.npmjs.com/package/csv-stringify" textvalue="csv-stringify" linktype="text" imgurl="" tab="outerlink" data-linktype="2">csv-stringify</a> 、 <a target="_blank" href="https://www.npmjs.com/package/cookie-signature" textvalue="cookie-signature " linktype="text" imgurl="" tab="outerlink" data-linktype="2">cookie-signature </a>、 <a target="_blank" href="https://www.npmjs.com/package/stream-slice" textvalue="stream-slice " linktype="text" imgurl="" tab="outerlink" data-linktype="2">stream-slice </a>等。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">对于所有启用了<a target="_blank" href="https://developers.cloudflare.com/workers/runtime-apis/nodejs/" textvalue="现有 nodejs_compat 兼容性标志" linktype="text" imgurl="" tab="outerlink" data-linktype="2">现有 nodejs_compat 兼容性标志</a>且<a target="_blank" href="https://developers.cloudflare.com/workers/configuration/compatibility-dates/" textvalue="兼容性日期" linktype="text" imgurl="" tab="outerlink" data-linktype="2">兼容性日期</a>为 2024-09-23 或之后的 Workers，此行为很快将成为默认。在您试用改进的 Node.js 兼容性过程中，欢迎通过<a target="_blank" href="https://github.com/cloudflare/workers-sdk/issues/new?assignees=&amp;labels=bug&amp;projects=&amp;template=bug-template.yaml&amp;title=%F0%9F%90%9B+BUG%3A" textvalue="在 GitHub 提交问题来分享您的反馈" linktype="text" imgurl="" tab="outerlink" data-linktype="2">在 GitHub 提交问题来分享您的反馈</a> 。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(255, 104, 39);"><strong><span style="color: rgb(255, 104, 39);text-decoration: none;letter-spacing: 0.5px;">Workerd 不是 Node.js</span></strong></span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">要了解这些最新变化，我们先来简单了解一下 Workers 运行时与 <a target="_blank" href="https://nodejs.org/" textvalue="Node.js" linktype="text" imgurl="" tab="outerlink" data-linktype="2">Node.js</a> 的不同之处。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">Node.js 主要专为直接在主机操作系统上运行的服务而构建，是服务器端 JavaScript 的先驱。因此，它包括与主机交互所需的功能（例如 <a target="_blank" href="https://nodejs.org/api/process.html" textvalue="process" linktype="text" imgurl="" tab="outerlink" data-linktype="2">process</a> 或 <a target="_blank" href="https://nodejs.org/api/fs.html" textvalue="fs" linktype="text" imgurl="" tab="outerlink" data-linktype="2">fs</a> ），以及各种实用模块（例如 <a target="_blank" href="https://nodejs.org/api/crypto.html" textvalue="crypto " linktype="text" imgurl="" tab="outerlink" data-linktype="2">crypto </a>）。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">Cloudflare Workers 在一个名为 <a target="_blank" href="https://github.com/cloudflare/workerd" textvalue="workerd" linktype="text" imgurl="" tab="outerlink" data-linktype="2">workerd</a> 的开源 JavaScript/Wasm 运行时上运行。虽然 Node.js 和 workerd 都是在 <a target="_blank" href="https://v8.dev/" textvalue="V8" linktype="text" imgurl="" tab="outerlink" data-linktype="2">V8</a> 上构建的 ，但 workerd 设计为在共享<a target="_blank" href="https://blog.cloudflare.com/zh-cn/cloud-computing-without-containers/" textvalue="进程中运行不受信任的代码" linktype="text" imgurl="" tab="outerlink" data-linktype="2">进程中运行不受信任的代码</a> ，暴露 <a target="_blank" href="https://developers.cloudflare.com/workers/runtime-apis/bindings/" textvalue="绑定" linktype="text" imgurl="" tab="outerlink" data-linktype="2">绑定</a>以便与其他 Cloudflare 服务进行互操作，包括<a target="_blank" href="https://blog.cloudflare.com/javascript-native-rpc" textvalue="  JavaScript 原生 RPC" linktype="text" imgurl="" tab="outerlink" data-linktype="2"> &nbsp;JavaScript 原生 RPC</a> ，并尽可能使用 <a target="_blank" href="https://blog.cloudflare.com/zh-cn/introducing-the-wintercg/" textvalue="Web 标准 API" linktype="text" imgurl="" tab="outerlink" data-linktype="2">Web 标准 API</a> 。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">Cloudflare <a target="_blank" href="https://blog.cloudflare.com/zh-cn/introducing-the-wintercg/" textvalue="帮助建立了  WinterCG" linktype="text" imgurl="" tab="outerlink" data-linktype="2">帮助建立了 &nbsp;WinterCG</a> （Web 互操作运行时社区小组） ，其旨在提高 JavaScript 运行时之间以及运行时与 Web 平台的互操作性。您可以仅使用 Web 标准 API 构建许多应用，但是当您想从 NPM 导入依赖于 Node.js API 的依赖项时，该怎么办呢？</span></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">例如，如果您在未开启Node.js 兼容性的情况下尝试导入 <a target="_blank" href="https://www.npmjs.com/package/pg" textvalue="pg" linktype="text" imgurl="" tab="outerlink" data-linktype="2">pg</a> &nbsp;（一个 PostgreSQL 驱动程序）……</span></section><section style="text-align: justify;margin: 0px 16px 16px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;"><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100022843" data-ratio="0.053703703703703705" data-s="300,640" data-type="png" data-w="1080" style="" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2Fqcj0oPqOL8Wib0UDSXj1sXQHIzcCdHDSJKy0yFMvl96lKEHasnPb3T49odXIjGTFsILsymIQOwbexYNIlmklL5A%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg"></p></span></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">当运行 wrangler dev 以构建您的 Worker 时，将看到如下错误：</span></section><section style="text-align: center;margin-left: 16px;margin-right: 16px;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100022844" data-ratio="0.16018518518518518" data-s="300,640" data-type="png" data-w="1080" style="width: 511px;height: 82px;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2Fqcj0oPqOL8Wib0UDSXj1sXQHIzcCdHDSJoglGMFXibH8ibID4UyC11Sucel14YVNFB9Ao6O4DBdeVUbbEqnfkbW1Q%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg"></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">发生这种情况是因为 pg 包从 Node.js 导入 <a target="_blank" href="https://nodejs.org/api/events.html" textvalue="events 模块" linktype="text" imgurl="" tab="outerlink" data-linktype="2">events 模块</a>，而 workerd 默认情况下不提供该模块。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">我们如何实现这一点？</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="color: rgb(255, 104, 39);"><strong><span style="color: rgb(255, 104, 39);text-decoration: none;letter-spacing: 0.5px;font-size: 15px;">我们的第一种方法 —— 构建时 polyfills</span></strong></span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">Polyfill 是为原生不支持某项功能的运行时添加功能的代码。这些代码通常用于为旧版浏览器提供现代 JavaScript 功能，但也可以用于服务器端运行时。</span></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">在 2022 年，我们 <a target="_blank" href="https://github.com/cloudflare/workers-sdk/pull/869" textvalue="为 Wrangler 添加了功能， 如果您在 wrangler.toml 中设置 " linktype="text" imgurl="" tab="outerlink" data-linktype="2">为 Wrangler 添加了功能， 如果您在 wrangler.toml 中设置 </a>node_compat = true ， 则可以将一些 Node.js API 的 polyfill 实现注入 Worker 中。以下代码在开启该标志时可以正常工作，但在关闭时则不行：</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100022846" data-ratio="0.07962962962962963" data-s="300,640" data-type="png" data-w="1080" style="text-align: center;font-size: var(--articleFontsize);letter-spacing: 0.034em;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2Fqcj0oPqOL8Wib0UDSXj1sXQHIzcCdHDSJ3HI6ZagSPvHXL2fAWiblaiblT4KDcGgTjXd5QkplQE3sPYZlVOkkH0KQ%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg"><br></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">这些 polyfill 本质上就是在部署 Worker 时由 <a target="_blank" href="https://developers.cloudflare.com/workers/wrangler/" textvalue="Wrangler" linktype="text" imgurl="" tab="outerlink" data-linktype="2">Wrangler</a> 添加到 Worker 的额外 JavaScript 代码。这个行为由 <a target="_blank" href="https://www.npmjs.com/package/@esbuild-plugins/node-globals-polyfill" textvalue="@esbuild-plugins/node-globals- polyfill" linktype="text" imgurl="" tab="outerlink" data-linktype="2">@esbuild-plugins/node-globals- polyfill</a> 支持实现，后者本身使用 &nbsp;<a target="_blank" href="https://github.com/ionic-team/rollup-plugin-node-polyfills/" textvalue="rollup-plugin-node-polyfills" linktype="text" imgurl="" tab="outerlink" data-linktype="2">rollup-plugin-node-polyfills</a>。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">这允许您导入和使用一些 NPM 包，例如 pg。然而，许多模块无法用足够快的代码进行 polyfill，或者根本无法被 polyfill。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">例如， <a target="_blank" href="https://nodejs.org/api/buffer.html" textvalue="Buffer" linktype="text" imgurl="" tab="outerlink" data-linktype="2">Buffer</a> 是用于处理二进制数据的常见 Node.js API。存在支持它的 polyfill，但 JavaScript 通常并没有针对它在内部执行的操作进行优化，例如 copy、concat、子字符串搜索或转码。虽然可以用纯 JavaScript 实现，但如果底层运行时可以使用来自不同语言的基元，那么速度还会更快。其他流行的 API，如 <a target="_blank" href="https://nodejs.org/api/crypto.html" textvalue="Crypto" linktype="text" imgurl="" tab="outerlink" data-linktype="2">Crypto</a> 、 <a target="_blank" href="https://nodejs.org/api/async_context.html" textvalue="AsyncLocalStorage" linktype="text" imgurl="" tab="outerlink" data-linktype="2">AsyncLocalStorage</a> 和 <a target="_blank" href="https://nodejs.org/api/stream.html" textvalue="Stream" linktype="text" imgurl="" tab="outerlink" data-linktype="2">Stream</a> ，也存在类似的限制。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="font-size: 15px;"><strong><span style="text-decoration: none;letter-spacing: 0.5px;color: rgb(255, 104, 39);">我们的第二种方法——在 Workers 运行时中原生支持一些 Node.js API</span></strong></span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">2023 年，我们<a target="_blank" href="https://blog.cloudflare.com/workers-node-js-asynclocalstorage" textvalue="开始将" linktype="text" imgurl="" tab="outerlink" data-linktype="2">开始将</a>一部分 Node.js API 直接添加到 Workers 运行时中。您可以通过向 Worker 添加<a target="_blank" href="https://developers.cloudflare.com/workers/runtime-apis/nodejs/" textvalue="nodejs_compatcompatible 标志" linktype="text" imgurl="" tab="outerlink" data-linktype="2">nodejs_compatcompatible 标志</a>来启用这些 API ，但不能同时将 polyfills 与 node_compat = true 一起使用。</span></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">此外，在导入 Node.js API 时，必须使用 node : prefix：</span></section><section style="text-align: center;margin-bottom: 32px;margin-left: 16px;margin-right: 16px;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100022848" data-ratio="0.05462962962962963" data-s="300,640" data-type="png" data-w="1080" style="width: 512px;height: 28px;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2Fqcj0oPqOL8Wib0UDSXj1sXQHIzcCdHDSJsQR4Dk4xmSaiaInHkdTgehJfCQhAE8EeEKap4TuZ9VQBfeLjIATh4kg%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg"></section><section style="margin-left: 16px;margin-right: 16px;"><span style="font-size: 14px;">由于这些 Node.js API 直接内置于 Workers 运行时中，因此可以</span><a target="_blank" href="https://github.com/cloudflare/workerd/blob/main/src/workerd/api/node/buffer.c%2B%2B" textvalue="用 C++ 编写" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="font-size: 14px;"><span style="font-size: 14px;">用 C++ 编写</span></a><span style="font-size: 14px;">，这使得它们比 JavaScript polyfill 更快。像</span><a target="_blank" href="https://developers.cloudflare.com/workers/runtime-apis/nodejs/asynclocalstorage/" textvalue=" AsyncLocalStorage" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="font-size: 14px;"><span style="font-size: 14px;"> AsyncLocalStorage</span></a><span style="font-size: 14px;"> 这样的 API （不能在不影响安全性和性能的情况下进行 polyfill）可以原生提供。</span></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">要求 node: prefix 使导入更加明确，并与现代 Node.js 约定保持一致。不幸的是，现有的 NPM 包可能不使用 &nbsp;node: 导入。例如，回顾一下上面的示例，如果您在带有 nodejs_compat 标志的 Worker 中导入流行程序包 pg，您仍然会看到以下错误：</span></section><section style="text-align: center;margin-left: 16px;margin-right: 16px;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100022849" data-ratio="0.16018518518518518" data-s="300,640" data-type="png" data-w="1080" style="width: 510px;height: 82px;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2Fqcj0oPqOL8Wib0UDSXj1sXQHIzcCdHDSJsnRtrfFdqCT8c1pwaiaO8YtvcqiaoozHDugIWficZgGMrYmvlJEL7gSDg%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg"></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">即使您启用了 nodejs_compat 兼容性标志，许多 NPM 包仍然不能在 Workers 中运行。您必须在较小的高性能 API 集（以许多 NPM 包无法访问的方式暴露）之间进行选择，亦或是在较大的不完整、性能较低的 API 集之间进行选择。而在 Node.js 中暴露为全局变量的 API ，例如 process ，仍然只能通过将其作为模块导入来访问。</span><br></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="color: rgb(255, 104, 39);"><strong><span style="color: rgb(255, 104, 39);text-decoration: none;letter-spacing: 0.5px;font-size: 15px;">新方式：混合模型</span></strong></span></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">如果我们可以做到两全其美并能顺利运行，那会如何？</span></section><ul class="list-paddingleft-1" style="list-style-type: square;"><li><p style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">在 Workers 运行时中直接实现的 Node.js API 子集</span></p></li><li><p style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">适用于其他大多数 Node.js API 的 Polyfill</span></p></li><li><p style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">不需要 node : prefix</span></p></li><li><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">一个简单的选择使用方式</span></section></li></ul><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">改进后的 Node.js 兼容性就能做到这一点。</span></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">我们来看看两行代码，看起来相似，但在启用 nodejs_compat_v2 后，内部行为有所不同：</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100022850" data-ratio="0.06574074074074074" data-s="300,640" data-type="png" data-w="1080" style="text-align: center;font-size: var(--articleFontsize);letter-spacing: 0.034em;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2Fqcj0oPqOL8Wib0UDSXj1sXQHIzcCdHDSJmFLp981tjia4puWeSj1whqJ4rWwSia3Z1Jm1LFU6Y4h6ksUxUMjAA3kg%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg"><br></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;">第一行从 workerd 中的 JavaScript <a target="_blank" href="https://github.com/cloudflare/workerd/blob/main/src/node/internal/internal_buffer.ts" textvalue="模块导入" linktype="text" imgurl="" tab="outerlink" data-linktype="2">模块导入</a> Buffer，<a target="_blank" href="https://github.com/cloudflare/workerd/blob/main/src/workerd/api/node/buffer.c%2B%2B" textvalue="该模块由 C++ 代码" linktype="text" imgurl="" tab="outerlink" data-linktype="2">该模块由 C++ 代码</a>支持。其他各种 Node.js 模块也类似地以 Typescript 和 C++ 的组合实现，包括 &nbsp;<a target="_blank" href="https://github.com/cloudflare/workerd/blob/main/src/workerd/api/node/async-hooks.h" textvalue="AsyncLocalStorage" linktype="text" imgurl="" tab="outerlink" data-linktype="2">AsyncLocalStorage</a> 和 <a target="_blank" href="https://github.com/cloudflare/workerd/blob/main/src/workerd/api/node/crypto.h" textvalue="&nbsp;Crypto" linktype="text" imgurl="" tab="outerlink" data-linktype="2">&nbsp;Crypto</a> 。这样允许编写与 Node.js 行为相匹配的高性能代码。</span><br></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">请注意，导入 buffer 时不需要 node: prefix ，即使用 node:buffer 代码也能工作。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">第二行导入 net，Wrangler 使用一个名为 <a target="_blank" href="https://github.com/unjs/unenv" textvalue="unenv " linktype="text" imgurl="" tab="outerlink" data-linktype="2">unenv </a>的库自动 polyfill 。Polyfill 和内置运行时 API 现在可以协同工作。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">在以前的版本中，当您设置 node_compat = true 时，Wrangler 会在能够的情况下为每个 Node.js API 添加 polyfill，即使您的 Worker 及其依赖项都没有使用该 API。当您启用 <a target="_blank" href="https://developers.cloudflare.com/workers/runtime-apis/nodejs/" textvalue="nodejs_compat_v2compatible_flag" linktype="text" imgurl="" tab="outerlink" data-linktype="2">nodejs_compat_v2compatible_flag</a> 时，Wrangler 只会为您的 Worker 或其依赖项实际使用的 Node.js API 添加 polyfill。结果是，即使使用了 polyfill，Worker 也会很小。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">对于某些 Node.js API，Workers 运行时中尚未提供原生支持，也没有 polyfill 实现。在这些情况下，unenv 会“模拟”接口。这意味着它会将该模块及其方法添加到您的 Worker，但调用该模块的方法要么不执行任何操作，要么抛出错误，并显示类似以下的消息：</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">[unenv] </span><method name=""><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;"> is not implemented yet!</span></method></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">这比看起来更为重要。因为如果一个 Node.js API 被“模拟”，那么依赖它的 NPM 包仍然可以被导入。请考虑以下代码：</span></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 0.5px;text-indent: 0em;"><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100022851" data-ratio="0.35" data-s="300,640" data-type="png" data-w="1080" style="" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2Fqcj0oPqOL8Wib0UDSXj1sXQHIzcCdHDSJ4vchF119zg7OpkuVFT5YzPVrVDcorGiboeFY8BP2sSf35vxd43q0TRA%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg"></p></span></section><section style="text-align: justify;margin-left: 16px;margin-right: 16px;"><span style="font-size: 14px;">以前，即使启用了</span><a target="_blank" href="https://developers.cloudflare.com/workers/runtime-apis/nodejs/" textvalue="现有的 nodejs_compat 兼容性标志" linktype="text" imgurl="" tab="outerlink" style="font-size: 14px;" data-linktype="2"><span style="font-size: 14px;">现有的 nodejs_compat 兼容性标志</span></a><span style="font-size: 14px;">，尝试导入 my-module 也会在构建时失败，因为无法解析 fs 模块。现在，fs 模块可以解析，不依赖于未实现的 Node.js API 的方法可以奏效，而那些确实抛出错误的方法会给出更具体的错误信息——一个运行时错误，表明某个特定的 Node.js API 方法尚不支持，而不是构建时错误，指明模块无法被解析。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">这就是为什么某些包从“在 Workers 上甚至不加载” 转变为 “可以加载，但有一些不受支持的方法”。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="color: rgb(255, 104, 39);font-size: 15px;"><strong><span style="color: rgb(255, 104, 39);text-decoration: none;letter-spacing: 0.5px;">依然缺少 Node.js 的某个 API？模块别名来帮忙</span></strong></span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">假设您需要一个 NPM 包在 Workers 上工作，其依赖于尚未在 Workers 运行时中实现的 Node.js API ，或作为 unenv 中的 polyfill 。您可以使用<a target="_blank" href="https://developers.cloudflare.com/workers/wrangler/configuration/#module-aliasing" textvalue="模块别名" linktype="text" imgurl="" tab="outerlink" data-linktype="2">模块别名</a>来实现刚好足够正常工作的 API。</span></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">例如，假设您需要工作的 NPM 包调用<a target="_blank" href="https://nodejs.org/api/fs.html#fsreadfilepath-options-callback" textvalue=" fs.readFile " linktype="text" imgurl="" tab="outerlink" data-linktype="2"> fs.readFile </a>。您可以通过将以下内容添加到 Worker 的 wrangler.toml 来为 fs 模块起别名：</span></section><section style="text-align: center;margin-left: 16px;margin-right: 16px;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100022854" data-ratio="0.08518518518518518" data-s="300,640" data-type="png" data-w="1080" style="width: 513px;height: 44px;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2Fqcj0oPqOL8Wib0UDSXj1sXQHIzcCdHDSJmndtCqHyyQFvHqFJRtWqQDOgiaXK71I5tFkRcKshQINnUOLcbBXiaNicA%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg"></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">然后，在 fs- polyfill.js 文件中，您可以定义自己对 fs 模块的任何方法的实现：</span></section><section style="text-align: center;margin-left: 16px;margin-right: 16px;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100022855" data-ratio="0.1361111111111111" data-s="300,640" data-type="png" data-w="1080" style="width: 510px;height: 69px;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2Fqcj0oPqOL8Wib0UDSXj1sXQHIzcCdHDSJ1YJAfeH6Z2ibPw4y64MF2icXt40DTV5iaWPBEibm9qhBMM8RDJZPSgQ9XQ%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg"></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">以下代码之前抛出错误信息“[unenv] readFile is not implemented yet!”，现在则可以正常运行：</span></section><section style="text-align: center;margin-left: 16px;margin-right: 16px;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100022856" data-ratio="0.24351851851851852" data-s="300,640" data-type="png" data-w="1080" style="width: 512px;height: 125px;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2Fqcj0oPqOL8Wib0UDSXj1sXQHIzcCdHDSJOK5Tzg4ibbYic8iaP8AmbzRMQIciancb3YzmABCURLnWrrHDr932QIFfww%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg"></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">您还可以使用模块别名来提供一个在 Workers 上不起作用的 NPM 包的实现，即使您只是间接依赖该 NPM 包（作为您的 Worker 的某个依赖项的依赖项）。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">例如， <a target="_blank" href="https://www.npmjs.com/package/cross-fetch" textvalue="cross-fetch " linktype="text" imgurl="" tab="outerlink" data-linktype="2">cross-fetch </a>等一些 NPM 包依赖于 <a target="_blank" href="https://www.npmjs.com/package/node-fetch" textvalue="node-fetch" linktype="text" imgurl="" tab="outerlink" data-linktype="2">node-fetch</a> ，后者在 <a target="_blank" href="https://developers.cloudflare.com/workers/runtime-apis/fetch/" textvalue="fetch() API" linktype="text" imgurl="" tab="outerlink" data-linktype="2">fetch() API</a>在内置到 Node.js 之前提供其 polyfill。Workers 中不需要 node-fetch 包，因为 fetch() API 由 Workers 运行时提供。node-fetch 在 Workers 不能工作 ，因为它依赖的 <a target="_blank" href="https://nodejs.org/api/http.html" textvalue="http" linktype="text" imgurl="" tab="outerlink" data-linktype="2">http</a> 和 <a target="_blank" href="https://nodejs.org/api/https.html" textvalue="https" linktype="text" imgurl="" tab="outerlink" data-linktype="2">https</a> 模块中的 Node.js API 目前不受支持。</span></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">您可以为 node-fetch 的所有导入设置别名，使其直接指向使用流行的 <a target="_blank" href="https://github.com/SukkaW/nolyfill" textvalue="nolyfill " linktype="text" imgurl="" tab="outerlink" data-linktype="2">nolyfill </a>包内置于 Workers 运行时的 fetch() API ：</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100022857" data-ratio="0.08148148148148149" data-s="300,640" data-type="png" data-w="1080" style="text-align: center;text-indent: 0em;font-size: var(--articleFontsize);letter-spacing: 0.034em;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2Fqcj0oPqOL8Wib0UDSXj1sXQHIzcCdHDSJUBefZxh153LU8IYeibm9NQjGIV9w5Pdic3QJFlzztqJ7IibDmCs4XVjCw%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg"></section><section style="text-align: justify;margin: 0px 16px 8px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">在这种情况下，您的替代模块只需重新导出 Workers 运行时内置的 fetch API 即可：</span></section><section style="text-align: center;margin-left: 16px;margin-right: 16px;"><img class="rich_pages wxw-img" data-galleryid="" data-imgfileid="100022858" data-ratio="0.05" data-s="300,640" data-type="png" data-w="1080" style="width: 508px;height: 25px;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2Fqcj0oPqOL8Wib0UDSXj1sXQHIzcCdHDSJnq5OsXfo8ViaKANGibzbm1H63fyTdRsoYwoM9sDYaic2wdOmPJT8nXjbQ%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg"></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="font-size: 15px;"><strong><span style="text-decoration: none;letter-spacing: 0.5px;color: rgb(255, 104, 39);">向 unenv 回报贡献</span></strong></span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">Cloudflare 正在为 unenv 积极做贡献。我们认为 unenv 正在以正确的方式解决跨运行时兼容性问题——它会根据您使用的 API 和针对的运行时，仅向您的应用程序添加必要的 polyfill。该项目支持也 workerd 之外的各种运行时，并且已经被包括 <a target="_blank" href="https://nuxt.com/" textvalue="Nuxt" linktype="text" imgurl="" tab="outerlink" data-linktype="2">Nuxt</a> 和 <a target="_blank" href="https://nitro.unjs.io/" textvalue="Nitro" linktype="text" imgurl="" tab="outerlink" data-linktype="2">Nitro</a> 在内的其他流行项目使用。我们要感谢 <a target="_blank" href="https://github.com/pi0" textvalue="Pooya Parsa" linktype="text" imgurl="" tab="outerlink" data-linktype="2">Pooya Parsa</a>和 unenv 的维护者，并鼓励生态系统中的更多人采用或贡献。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="font-size: 15px;"><strong><span style="text-decoration: none;letter-spacing: 0.5px;color: rgb(255, 104, 39);">下一步</span></strong></span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">目前，您可以通过在 wrangler.toml 中设置 nodejs_compat_v2 标志来启用改进的 Node.js 兼容性 。我们从 9 月 23 日起使该新行为成为使用 nodejs_compat 标志时的默认行为。这将需要更新 compatibility_date。</span></section><section style="text-align: justify;margin: 0px 16px 32px;text-indent: 0em;line-height: 1.75em;"><span style="text-decoration: none;font-size: 14px;letter-spacing: 0.5px;">我们对即将到来的 Node.js 兼容性变化感到兴奋，同时也十分鼓励您即刻就进行尝试。<a target="_blank" href="https://developers.cloudflare.com/workers/runtime-apis/nodejs/" textvalue="查看文档" linktype="text" imgurl="" tab="outerlink" data-linktype="2">查看文档</a>，了解如何为你的 Workers 选择加入。如果有任何反馈或错误，请<a target="_blank" href="https://github.com/cloudflare/workers-sdk/issues/new?assignees=&amp;labels=bug&amp;projects=&amp;template=bug-template.yaml&amp;title=%F0%9F%90%9B+BUG%3A" textvalue="通过提交问题" linktype="text" imgurl="" tab="outerlink" data-linktype="2">通过提交问题</a>告知我们。这样可以帮助我们识别支持中的任何错漏，确保尽可能多的 Node.js 生态系统能够在 Workers 上运行。</span></section><section style="letter-spacing: 0.578px;white-space: normal;caret-color: rgba(0, 0, 0, 0);text-align: center;margin-left: 16px;margin-right: 16px;"><img class="rich_pages wxw-img" data-imgfileid="100022859" data-ratio="0.032407407407407406" data-s="300,640" data-type="other" data-w="1080" style="display: inline;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2Fqcj0oPqOL8W0Sy9icv9XFicFy9wHepP5JZ610Rn8BiauhADZmWSiczlxhPt5OvS93iahicHztHprVRfhCcVTibVCbwxvg%2F640%3Fwx_fmt%3Dpng"></section><section style="letter-spacing: 0.578px;text-indent: 0em;white-space: normal;caret-color: rgba(0, 0, 0, 0);line-height: 1.75em;margin-left: 16px;margin-right: 16px;"><span style="color: rgb(0, 0, 0);text-indent: 0em;font-size: 14px;letter-spacing: 1px;">Cloudflare 保护</span><a target="_blank" href="https://www.cloudflare-cn.com/network-services/" textvalue="整个企业网络" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="color: rgb(121, 123, 170);text-indent: 0em;font-size: 14px;letter-spacing: 1px;">整个企业网络</a><span style="color: rgb(0, 0, 0);text-indent: 0em;font-size: 14px;letter-spacing: 1px;">，帮助客户高效构建</span><a target="_blank" href="https://workers.cloudflare.com/" textvalue="互联网规模的应用程序" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="color: rgb(121, 123, 170);text-indent: 0em;font-size: 14px;letter-spacing: 1px;">互联网规模的应用程序</a><span style="color: rgb(0, 0, 0);text-indent: 0em;font-size: 14px;letter-spacing: 1px;">，加速任何</span><a target="_blank" href="https://www.cloudflare-cn.com/application-services/products/" textvalue="网站或互联网应用程序" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="color: rgb(121, 123, 170);text-indent: 0em;font-size: 14px;letter-spacing: 1px;">网站或互联网应用程序</a><span style="color: rgb(0, 0, 0);text-indent: 0em;font-size: 14px;letter-spacing: 1px;">，</span><a target="_blank" href="https://www.cloudflare-cn.com/ddos/" textvalue="抵御 DDoS 攻击" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="color: rgb(121, 123, 170);text-indent: 0em;font-size: 14px;letter-spacing: 1px;">抵御 DDoS 攻击</a><span style="color: rgb(0, 0, 0);text-indent: 0em;font-size: 14px;letter-spacing: 1px;">，防止</span><a target="_blank" href="https://www.cloudflare-cn.com/application-services/products/" textvalue="黑客入侵" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="color: rgb(121, 123, 170);text-indent: 0em;font-size: 14px;letter-spacing: 1px;">黑客入侵</a><span style="color: rgb(0, 0, 0);text-indent: 0em;font-size: 14px;letter-spacing: 1px;">，并能协助您</span><a target="_blank" href="https://www.cloudflare-cn.com/zero-trust/" textvalue="实现 Zero Trust 的部署与实施。" linktype="text" imgurl="" tab="outerlink" data-linktype="2" style="text-indent: 0em;font-size: var(--articleFontsize);letter-spacing: 0.034em;"><span style="text-indent: 0em;font-size: 14px;letter-spacing: 1px;color: rgb(121, 123, 170);">实现 Zero Trust 的部署与实施</span><span style="font-size: 14px;letter-spacing: 1px;">。</span></a><br></section><section style="letter-spacing: 0.578px;text-indent: 0em;white-space: normal;caret-color: rgba(0, 0, 0, 0);line-height: 1.75em;margin-left: 16px;margin-right: 16px;"><a target="_blank" href="https://www.cloudflare-cn.com/zero-trust/" textvalue="实现 Zero Trust 的部署与实施。" linktype="text" imgurl="" tab="outerlink" data-linktype="2"></a></section><section style="padding-right: 2px;padding-left: 2px;white-space: normal;caret-color: rgba(0, 0, 0, 0);font-size: 14px;letter-spacing: 1px;line-height: 2;"><section style="padding-right: 2px;padding-left: 2px;line-height: 2;"><section style="padding-right: 2px;padding-left: 2px;line-height: 2;"><section style="margin: 10px 16px;text-align: center;line-height: 2em;"><img class="rich_pages wxw-img __bg_gif" data-imgfileid="100022860" data-ratio="0.1875" data-type="gif" data-w="128" data-width="10%" width="76.6875px" style="vertical-align: inherit;color: rgb(0, 0, 0);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: medium;letter-spacing: 0.544px;outline: 0px;display: inline;visibility: visible !important;width: 76.6875px !important;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fmmbiz_gif%2Fqcj0oPqOL8WRAJPov5pUf8xVn8kcib92nURHzicicTiaUS09SDbXiczaOljUY24HLKn8fBYgFVs7YJxC6sb6pELsia8w%2F640%3Fwx_fmt%3Dgif"><br></section></section></section></section><section style="white-space: normal;caret-color: rgba(0, 0, 0, 0);outline: 0px;letter-spacing: 0.544px;color: rgb(0, 0, 0);font-size: medium;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;background-color: rgb(255, 255, 255);vertical-align: inherit;text-align: center;line-height: 2em;margin-left: 16px;margin-right: 16px;"><img class="rich_pages wxw-img" data-imgfileid="100022861" data-ratio="1.3333333333333333" data-type="jpeg" data-w="1080" style="vertical-align: middle;color: rgb(34, 34, 34);font-family: system-ui, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;letter-spacing: 1px;width: 536px;display: inline;" src="https://images.weserv.nl?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fmmbiz_jpg%2Fqcj0oPqOL8U1f7auhwibp6jriako6rplw9FOL8uiaMVnq3oUzX0XXcLEjAGOVeo41ticppRIXJ5ODxibHfqKa0MEqQA%2F640%3Fwx_fmt%3Djpeg"></section><section style="display: none;margin-left: 16px;margin-right: 16px;"><br></section><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p></body></html></body></html>