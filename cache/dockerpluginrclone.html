<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8" /><title>在Docker中使用Rclone(插件)作为储存卷</title></head><body><h1 class="text-2xl font-semibold mb-2">在Docker中使用Rclone(插件)作为储存卷</h1><h1 data-v-2505e99a="" data-v-c0b8fcf4=""><strong data-v-2505e99a="">前言：</strong></h1><p data-v-2505e99a="" data-v-c0b8fcf4=""><span data-v-2505e99a="">在各个平台，或本地使用 </span><span data-v-2505e99a=""> 时，一定会遇到一些容器，想让它们的储存同步到云端，方便以后新建容器时好继承上一个容器的储存。本文会教大家如何安装 </span><span data-v-2505e99a=""> 作为 </span><span data-v-2505e99a=""> 插件，以方便使用各个云平台作为容器储存卷。*本文提到的</span><span data-v-2505e99a="">若未明确表达均指代 </span><span data-v-2505e99a="">。部分内容来自 </span><span data-v-2505e99a="">https://rclone.org/docker/</span><span data-v-2505e99a=""> </span></p><h1 data-v-2505e99a="" data-v-c0b8fcf4=""><strong data-v-2505e99a="">准备：</strong></h1><p data-v-2505e99a="" data-v-c0b8fcf4=""><span data-v-2505e99a="">你需要准备一个有 </span><span data-v-2505e99a=""> 以上的环境，推荐 </span><span data-v-2505e99a=""> 可以使用 </span><span data-v-2505e99a=""> 查看你当前安装的 Docker 版本。并安装 </span><span data-v-2505e99a=""> (可选)：</span></p><figure class="opus-para-code"><pre lang="language-xml" codecontent="Client%3A%0AVersion%3A%20%20%20%20%20%20%20%20%20%20%2020.10.17%2Bazure-1%0AAPI%20version%3A%20%20%20%20%20%20%201.41%0AGo%20version%3A%20%20%20%20%20%20%20%20go1.17.11%0AGit%20commit%3A%20%20%20%20%20%20%20%20%0ABuilt%3A%20%20%20%20%20%20%20%20%20%20%20%20%20Mon%20Jun%20%206%2021%3A36%3A39%20UTC%202022%0AOS%2FArch%3A%20%20%20%20%20%20%20%20%20%20%20linux%2Famd64%0AContext%3A%20%20%20%20%20%20%20%20%20%20%20default%0AExperimental%3A%20%20%20%20%20%20true%0A%0AServer%3A%0AEngine%3A%0A%20Version%3A%20%20%20%20%20%20%20%20%20%2020.10.17%2Bazure-1%0A%20API%20version%3A%20%20%20%20%20%201.41%20(minimum%20version%201.12)%0A%20Go%20version%3A%20%20%20%20%20%20%20go1.17.11%0A%20Git%20commit%3A%20%20%20%20%20%20%0A%20Built%3A%20%20%20%20%20%20%20%20%20%20%20%20Mon%20Jun%20%206%2022%3A32%3A38%202022%0A%20OS%2FArch%3A%20%20%20%20%20%20%20%20%20%20linux%2Famd64%0A%20Experimental%3A%20%20%20%20%20false"><code class="language-xml"></code></pre></figure><p data-v-2505e99a="" data-v-c0b8fcf4=""><span data-v-2505e99a="">开始：</span></p><h1 data-v-2505e99a="" data-v-c0b8fcf4=""><strong data-v-2505e99a="">安装流程：</strong></h1><ol><li class="level-1" data-v-2505e99a=""><span data-v-2505e99a="">首先你需要在你的 主机(VPS等) 安装 </span><span data-v-2505e99a="">FUSE</span><span data-v-2505e99a=""> 模块，这是必要的！</span></li></ol><figure class="opus-para-code"><pre lang="language-shell" codecontent="sudo%20apt-get%20-y%20install%20fuse"><code class="language-shell"></code></pre></figure><ol><li class="level-1" data-v-2505e99a=""><span data-v-2505e99a="">创建两个 </span><span data-v-2505e99a="">rclone docker plugin</span><span data-v-2505e99a=""> 的数据缓存文件夹（默认）</span></li></ol><figure class="opus-para-code"><pre lang="language-shell" codecontent="sudo%20mkdir%20-p%20%2Fvar%2Flib%2Fdocker-plugins%2Frclone%2Fconfig%0Asudo%20mkdir%20-p%20%2Fvar%2Flib%2Fdocker-plugins%2Frclone%2Fcache"><code class="language-shell"></code></pre></figure><ol><li class="level-1" data-v-2505e99a=""><span data-v-2505e99a="">为你的docker安装插件</span></li></ol><figure class="opus-para-code"><pre lang="language-shell" codecontent="docker%20plugin%20install%20rclone%2Fdocker-volume-rclone%3Aamd64%20args%3D%26amp%3Bquot%3B-v%26amp%3Bquot%3B%20--alias%20rclone%20--grant-all-permissions%0Adocker%20plugin%20list%20%23%E6%9F%A5%E7%9C%8B%E6%8F%92%E4%BB%B6%E5%88%97%E8%A1%A8%20%E5%87%BA%E7%8E%B0NAME%3Drclone%3Alatest%3BENABLED%3Dtrue%20%E8%AF%B4%E6%98%8E%E5%AE%89%E8%A3%85%E5%B9%B6%E5%90%AF%E7%94%A8%E6%88%90%E5%8A%9F%E4%BA%86"><code class="language-shell"></code></pre></figure><ol><li class="level-1" data-v-2505e99a=""><span data-v-2505e99a="">你可以根据需求，更换 </span><span data-v-2505e99a="">rclone.conf</span><span data-v-2505e99a=""> 及 </span><span data-v-2505e99a="">cache</span><span data-v-2505e99a=""> 文件夹</span></li></ol><figure class="opus-para-code"><pre lang="language-shell" codecontent="docker%20plugin%20disable%20rclone%20%23%E7%A6%81%E7%94%A8rclone%E6%8F%92%E4%BB%B6%0Adocker%20plugin%20set%20rclone%20RCLONE_VERBOSE%3D2%20config%3D%2Froot%2F.config%2Frclone%20cache%3D%2Ftmp%2Frclone%20args%3D%26amp%3Bquot%3B--vfs-cache-mode%3Dwrites%20--allow-other%26amp%3Bquot%3B%20%23%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A4%B9%E5%8F%8A%E7%BC%93%E5%AD%98%E6%96%87%E4%BB%B6%E5%A4%B9%0Adocker%20plugin%20enable%20rclone%20%23%E5%90%AF%E7%94%A8rclone%E6%8F%92%E4%BB%B6%0Adocker%20plugin%20inspect%20rclone%20%23%E6%9F%A5%E7%9C%8B%E6%8F%92%E4%BB%B6%E9%85%8D%E7%BD%AE"><code class="language-shell"></code></pre></figure><p data-v-2505e99a="" data-v-c0b8fcf4=""><span data-v-2505e99a="">挂载流程：</span></p><h1 data-v-2505e99a="" data-v-c0b8fcf4=""><strong data-v-2505e99a="">SFTP 卷挂载示例</strong></h1><ol><li class="level-1" data-v-2505e99a=""><span data-v-2505e99a="">创建 </span><span data-v-2505e99a="">sftpvolume</span><span data-v-2505e99a=""> 卷（ sftpvolume为储存卷名 ）</span></li></ol><figure class="opus-para-code"><pre lang="language-shell" codecontent="docker%20volume%20create%20sftpvolume%20-d%20rclone%20-o%20type%3Dsftp%20-o%20sftp-host%3D_hostname_%20-o%20sftp-user%3D_username_%20-o%20sftp-pass%3D_password_%20-o%20allow-other%3Dtrue"><code class="language-shell"></code></pre></figure><ol><li class="level-1" data-v-2505e99a=""><span data-v-2505e99a="">创建使用 </span><span data-v-2505e99a="">sftpvolume</span><span data-v-2505e99a=""> 卷的容器</span></li></ol><figure class="opus-para-code"><pre lang="language-shell" codecontent="docker%20run%20--rm%20-it%20-v%20sftpvolume%3A%2Fmnt%20--workdir%20%2Fmnt%20ubuntu%3Alatest%20bash%0A%23%20sftpvolume%3A%2Fmnt%20%E6%8C%87%E7%9A%84%E6%98%AF%EF%BC%9A%E4%BD%A0SFTP%E4%B8%AD%20%2Fmnt%20%E7%9B%AE%E5%BD%95%EF%BC%88%E5%92%8C%E5%8E%9F%E7%89%88rclone%E6%98%AF%E4%B8%80%E6%A0%B7%EF%BC%89%0A%23%20--workdir%20%2Fmnt%20%E6%8C%87%E7%9A%84%E7%9A%84%EF%BC%9A%E5%AE%B9%E5%99%A8%E5%86%85%E9%83%A8%E7%9B%AE%E5%BD%95%20%2Fmnt"><code class="language-shell"></code></pre></figure><p data-v-2505e99a="" data-v-c0b8fcf4=""><span data-v-2505e99a="">如果一切配置正确的话，你会进入到这个新的容器。你可以输入</span><span data-v-2505e99a="">命令查看 /mnt 内容</span></p><h1 data-v-2505e99a="" data-v-c0b8fcf4=""><strong data-v-2505e99a="">任意网络盘挂载示例</strong></h1><p data-v-2505e99a="" data-v-c0b8fcf4=""><span data-v-2505e99a="">*</span><span data-v-2505e99a="">Rclone官方示例</span><span data-v-2505e99a=""> 为 Google Drive 我们这里用 Onedrive 做演示</span></p><ol><li class="level-1" data-v-2505e99a=""><span data-v-2505e99a="">在另外任意一台机器，创建你想挂载的网盘，比如 Onedrive，将生成的 </span><span data-v-2505e99a="">rclone.conf</span><span data-v-2505e99a=""> 配置文件 移动到你 主机(VPS等) 的 </span><span data-v-2505e99a="">/var/lib/docker-plugins/rclone/config/rclone.conf</span><span data-v-2505e99a=""> 目录（默认：如果没有走安装流程的第四步，就是一开始 </span><span data-v-2505e99a="">mkdir</span><span data-v-2505e99a=""> 的文件夹） &nbsp;</span><span data-v-2505e99a="">附录：创建网盘教程</span><span data-v-2505e99a=""> 配置文件看起来应该是下面这样（onedrive）：</span></li></ol><figure class="opus-para-code"><pre lang="language-xml" codecontent="%5Boodrive%5D%0Atype%20%3D%20onedrive%0Aclient_id%20%3D%20180xxxx2-0114-xxxxaf31-24aaxxxxx0cb%0Aclient_secret%20%3D%20Xik7Q~JxxxxxoaO8aKxxxxxvclxlxxxxx8%0Atoken%20%3D%20%7B%26amp%3Bquot%3Baccess_token%26amp%3Bquot%3B%3A%26amp%3Bquot%3Bxxx%26amp%3Bquot%3B%2C%26amp%3Bquot%3Bexpiry%26amp%3Bquot%3B%3A%26amp%3Bquot%3B2022-05-04T07%3A30%3A31.869533611%2B08%3A00%26amp%3Bquot%3B%7D%0Adrive_id%20%3D%20b!xxxxxxxx-SdYUkcM9xT9TKp%0Adrive_type%20%3D%20business"><code class="language-xml"></code></pre></figure><ol><li class="level-1" data-v-2505e99a=""><span data-v-2505e99a="">创建一个文件名为 </span><span data-v-2505e99a="">example.yml</span><span data-v-2505e99a=""> 的 docker swarm stack：</span></li></ol><figure class="opus-para-code"><pre lang="language-yaml" codecontent="version%3A%20%26amp%3B%2339%3B3%26amp%3B%2339%3B%0Aservices%3A%0A%20heimdall%3A%0A%20%20%20image%3A%20linuxserver%2Fheimdall%3Alatest%0A%20%20%20ports%3A%20%5B8080%3A80%5D%0A%20%20%20volumes%3A%20%5Bconfigdata%3A%2Fconfig%5D%0Avolumes%3A%0A%20configdata%3A%0A%20%20%20driver%3A%20rclone%0A%20%20%20driver_opts%3A%0A%20%20%20%20%20remote%3A%20%26amp%3B%2339%3Boodrive%3Aheimdall%26amp%3B%2339%3B%0A%20%20%20%20%20allow_other%3A%20%26amp%3B%2339%3Btrue%26amp%3B%2339%3B%0A%20%20%20%20%20vfs_cache_mode%3A%20full%0A%20%20%20%20%20poll_interval%3A%200"><code class="language-yaml"></code></pre></figure><ol><li class="level-1" data-v-2505e99a=""><span data-v-2505e99a="">运行这个stack</span></li></ol><figure class="opus-para-code"><pre lang="language-shell" codecontent="docker%20stack%20deploy%20example%20-c%20.%2Fexample.yml"><code class="language-shell"></code></pre></figure><ol><li class="level-1" data-v-2505e99a=""><span data-v-2505e99a="">在一段时间后，会创建 </span><span data-v-2505e99a="">example_heimdall</span><span data-v-2505e99a=""> 服务并在8080端口启动，你可以使用以下指令查看</span></li></ol><figure class="opus-para-code"><pre lang="language-shell" codecontent="docker%20service%20ls%0Adocker%20service%20ps%20example_heimdall%0Adocker%20volume%20ls"><code class="language-shell"></code></pre></figure><ol><li class="level-1" data-v-2505e99a=""><span data-v-2505e99a="">在测试结束后你可以使用 </span><span data-v-2505e99a="">docker stack remove example</span><span data-v-2505e99a=""> 移除服务，使用 </span><span data-v-2505e99a="">docker volume remove example_configdata</span><span data-v-2505e99a=""> 移除储存卷。</span></li></ol><h1 data-v-2505e99a="" data-v-c0b8fcf4=""><strong data-v-2505e99a="">使用CLI创建卷</strong></h1><figure class="opus-para-code"><pre lang="language-shell" codecontent="docker%20volume%20create%20vol1%20-d%20rclone%20-o%20remote%3Dstorj%3A%20-o%20vfs-cache-mode%3Dfull%0Adocker%20volume%20create%20vol2%20-d%20rclone%20-o%20remote%3D%3Astorj%2Caccess_grant%3Dxxx%3Aheimdall%0Adocker%20volume%20create%20vol3%20-d%20rclone%20-o%20type%3Dstorj%20-o%20path%3Dheimdall%20-o%20storj-access-grant%3Dxxx%20-o%20poll-interval%3D0"><code class="language-shell"></code></pre></figure><p data-v-2505e99a="" data-v-c0b8fcf4=""><span data-v-2505e99a="">使用Docker Swarm 或Docker Compose</span></p><figure class="opus-para-code"><pre lang="language-yaml" codecontent="volumes%3A%0A%20volume_name_1%3A%0A%20%20%20driver%3A%20rclone%0A%20%20%20driver_opts%3A%0A%20%20%20%20%20remote%3A%20%26amp%3B%2339%3Boodrive%3A%26amp%3B%2339%3B%0A%20%20%20%20%20allow_other%3A%20%26amp%3B%2339%3Btrue%26amp%3B%2339%3B%0A%20%20%20%20%20vfs_cache_mode%3A%20writes%0A%20%20%20%20%20token%3A%20%26amp%3B%2339%3B%7B%26amp%3Bquot%3Btype%26amp%3Bquot%3B%3A%20%26amp%3Bquot%3Bborrower%26amp%3Bquot%3B%2C%20%26amp%3Bquot%3Bexpires%26amp%3Bquot%3B%3A%20%26amp%3Bquot%3B2021-12-31%26amp%3Bquot%3B%7D%26amp%3B%2339%3B%0A%20%20%20%20%20poll_interval%3A%200"><code class="language-yaml"></code></pre></figure><p data-v-2505e99a="" data-v-c0b8fcf4=""><span data-v-2505e99a="">实战总结：</span></p><p data-v-2505e99a="" data-v-c0b8fcf4=""><span data-v-2505e99a="">以下为使用 compos 部署 alist 并挂载云端的配置，注意 </span><span data-v-2505e99a=""> 为你的 </span><span data-v-2505e99a=""> 配置文件中的网盘名字，请读完全文再抄袭！</span></p><figure class="opus-para-code"><pre lang="language-yaml" codecontent="version%3A%20%26amp%3B%2339%3B3%26amp%3B%2339%3B%0Aservices%3A%0A%20alistr%3A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%E6%9C%8D%E5%8A%A1%E5%90%8D%20alistr%20%E4%BB%BB%E6%84%8F%0A%20%20%20image%3A%20xhofe%2Falist%3Alatest%20%20%20%20%20%20%20%20%23%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%20xhofe%2Falist%0A%20%20%20ports%3A%20%5B5244%3A5244%5D%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%E5%AE%B9%E5%99%A8%E7%AB%AF%E5%8F%A3%205244%0A%20%20%20network_mode%3A%20host%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F%20host%0A%20%20%20volumes%3A%20%5Badata%3A%2Fopt%2Falist%2Fdata%5D%20%23%E5%8D%B7%E5%90%8D%20adata%20%E6%8C%82%E8%BD%BD%E8%87%B3%E5%AE%B9%E5%99%A8%E5%86%85%2F%20opt%2Falist%2Fdata%0Avolumes%3A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%E5%82%A8%E5%AD%98%E5%8D%B7%E9%85%8D%E7%BD%AE%EF%BC%9A%0A%20adata%3A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%E5%AE%9A%E4%B9%89%E4%B8%8A%E9%9D%A2%E7%9A%84%E5%8D%B7%E5%90%8D%20adata%0A%20%20%20driver%3A%20rclone%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%E7%A3%81%E7%9B%98%E5%90%8D%20rclone%0A%20%20%20driver_opts%3A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%E7%A3%81%E7%9B%98%E9%85%8D%E7%BD%AE%0A%20%20%20%20%20remote%3A%20oodrive%3A%2Fexample%2Falist%20%23%E5%90%8C%E6%AD%A5%20oodrive%20%E4%B8%8B%20%2Fexample%2Falist%20%E6%96%87%E4%BB%B6%0A%20%20%20%20%20allow_other%3A%20%26amp%3B%2339%3Btrue%26amp%3B%2339%3B%20%20%20%20%20%20%20%20%20%20%20%20%23%E7%B1%BB%E4%BC%BCrclone%20mount%E9%85%8D%E7%BD%AE%0A%20%20%20%20%20vfs_cache_mode%3A%20writes%20%20%20%20%20%20%20%20%20%23%E7%B1%BB%E4%BC%BCrclone%20mount%E9%85%8D%E7%BD%AE%0A%20%20%20%20%20poll_interval%3A%200%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%E7%B1%BB%E4%BC%BCrclone%20mount%E9%85%8D%E7%BD%AE"><code class="language-yaml"></code></pre></figure><p data-v-2505e99a="" data-v-c0b8fcf4=""><span data-v-2505e99a="">
</span></p><h1 data-v-2505e99a="" data-v-c0b8fcf4=""><strong data-v-2505e99a="">结语：</strong></h1><p data-v-2505e99a="" data-v-c0b8fcf4=""><span data-v-2505e99a="">当然，你可以在每次机器启动后 手动/使用守护进程 挂载onedrive或其他rclone配置，再重启docker。但是使用插件可以大大增加效率，配置一次就能永久爽快体验。文章首发于：https://blog.learnonly.xyz/p/13d3.html 为金桔猪原创！</span></p><p data-v-2505e99a="" data-v-c0b8fcf4=""><span data-v-2505e99a="">
</span></p></body></html>